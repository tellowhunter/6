<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è¯­æ³•é€»è¾‘æŒ‘æˆ˜ (æœ€ç»ˆç‰ˆ)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* å­—ä½“æ ˆï¼šä¼˜å…ˆæ€æºé»‘ä½“ */
            --main-font: 'Source Han Sans CN', 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
            
            --primary: #2c3e50;
            --accent: #2980b9;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --green: #27ae60;
            --red: #c0392b;
            --text: #2d3436;
            --hint-text: #95a5a6;
        }

        body {
            font-family: var(--main-font);
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background: var(--card-bg);
            width: 100%;
            max-width: 850px;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
        }

        h1 { margin: 0 0 10px 0; font-weight: 700; letter-spacing: 1px; color: var(--primary); }
        p.subtitle { color: var(--hint-text); margin-bottom: 30px; }

        /* --- å±å¹•åˆ‡æ¢æ§åˆ¶ --- */
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .big-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            font-family: var(--main-font);
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }
        .big-btn:hover { background-color: #3498db; transform: translateY(-2px); }

        /* --- å¥å­æ˜¾ç¤ºåŒº (æ ¸å¿ƒä¿®æ”¹ï¼šåƒè‡ªç„¶æ–‡æœ¬ä¸€æ ·æµåŠ¨) --- */
        .sentence-box {
            font-size: 1.5rem; /* å­—å·é€‚ä¸­ï¼Œæ¸…æ™° */
            line-height: 2.4;  /* è¶³å¤Ÿçš„è¡Œé«˜å®¹çº³ä¸‹æ–¹çš„æç¤º */
            text-align: left;
            margin: 20px 0 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #eee;
            
            /* ä½¿ç”¨ Flex å¸ƒå±€ï¼Œä½†è®¾ç½®ç´§å‡‘çš„ gap */
            display: flex;
            flex-wrap: wrap; 
            align-items: baseline; /* åŸºçº¿å¯¹é½ï¼Œä¿è¯æ–‡å­—åœ¨ä¸€æ¡ç›´çº¿ä¸Š */
            gap: 8px 5px; /* è¡Œé—´è·8px, è¯é—´è·5px (æ›´ç´§å‡‘) */
        }

        /* å•è¯å•å…ƒï¼šåŒ…å«å•è¯æ–‡æœ¬å’Œä¸‹æ–¹çš„æç¤º */
        .word-unit {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            height: auto;
        }

        /* å•è¯æœ¬ä½“ */
        .word-text {
            z-index: 2;
        }

        /* ä¸‹æ–¹çš„è¯æ€§æç¤º */
        .pos-hint {
            font-size: 0.75rem;
            color: var(--hint-text);
            position: absolute;
            top: 100%; /* ä½äºå•è¯æ­£ä¸‹æ–¹ */
            margin-top: -2px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s;
            white-space: nowrap; /* é˜²æ­¢æç¤ºæ¢è¡Œ */
        }
        
        .show-hints .pos-hint { opacity: 1; }

        /* æŒ–ç©ºå¤„æ ·å¼ */
        .blank {
            display: inline-block;
            min-width: 80px;
            border-bottom: 2px solid var(--text); /* åªæœ‰ä¸‹åˆ’çº¿ï¼Œæ›´åƒå¡«ç©º */
            text-align: center;
            margin: 0 2px;
            height: 1.2em; /* å ä½ */
            color: transparent;
            transition: all 0.3s;
        }

        /* æ­æ™“ç­”æ¡ˆå */
        .revealed {
            color: var(--accent);
            font-weight: 700;
            border-bottom-color: var(--accent);
            padding: 0 5px;
        }

        /* æç¤ºå¼€å…³ */
        .hint-toggle {
            color: var(--hint-text);
            cursor: pointer;
            font-size: 0.95rem;
            margin-bottom: 25px;
            display: inline-block;
            border-bottom: 1px dashed var(--hint-text);
        }
        .hint-toggle:hover { color: var(--accent); border-color: var(--accent); }

        /* é€‰é¡¹ç½‘æ ¼ */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* ä¸€è¡Œ4ä¸ªï¼Œæ›´ç´§å‡‘ */
            gap: 15px;
        }
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; } /* æ‰‹æœºç«¯ä¸¤åˆ— */
        }

        .opt-btn {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--main-font);
            color: var(--text);
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .opt-btn:hover { background: #f8f9fa; border-color: var(--accent); transform: translateY(-1px); }
        .opt-btn:active { transform: translateY(0); }

        .opt-btn.correct { background: var(--green); border-color: var(--green); color: white; }
        .opt-btn.wrong { background: var(--red); border-color: var(--red); color: white; }

        /* çŠ¶æ€æ  */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: #7f8c8d;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .stats-bar b { color: var(--primary); }

        .feedback { height: 25px; font-weight: bold; margin-top: 15px; font-size: 1rem; }
        .disabled { pointer-events: none; opacity: 0.7; }
        
        .final-score { font-size: 3.5rem; font-weight: 700; color: var(--accent); display: block; margin: 20px 0; }

    </style>
</head>
<body>

<div class="container">
    
    <div id="startScreen" class="screen active">
        <h1>Grammar Logic Challenge</h1>
        <p class="subtitle">20 Questions Â· 5 Points Each Â· Max 100</p>
        <p style="margin: 40px 0; line-height: 1.6;">
            åˆ†æå¥å­ç»“æ„ï¼Œæ¨æ–­ç©ºæ ¼å¤„çš„è¯æ€§ã€‚<br>
            Prepare your logic!
        </p>
        <button class="big-btn" onclick="game.start()">å¼€å§‹æ¸¸æˆ (Start)</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="stats-bar">
            <span>Question: <b id="qCount">1</b> / 20</span>
            <span>Score: <b id="currentScore">0</b></span>
        </div>

        <div class="sentence-box" id="sentenceDisplay"></div>

        <div class="hint-toggle" id="hintBtn" onclick="game.toggleHints()">ğŸ’¡ æ˜¾ç¤ºå¥å­ç»“æ„æç¤º</div>

        <div class="options-grid" id="optContainer">
            <button class="opt-btn" onclick="game.check('n')">åè¯ (n.)</button>
            <button class="opt-btn" onclick="game.check('v')">åŠ¨è¯ (v.)</button>
            <button class="opt-btn" onclick="game.check('adj')">å½¢å®¹è¯ (adj.)</button>
            <button class="opt-btn" onclick="game.check('adv')">å‰¯è¯ (adv.)</button>
        </div>

        <div class="feedback" id="feedbackMsg"></div>
    </div>

    <div id="endScreen" class="screen">
        <h1>Game Over</h1>
        <p class="subtitle">æœ€ç»ˆå¾—åˆ†</p>
        <span class="final-score" id="finalScoreDisplay">0</span>
        <p id="resultComment" style="margin-bottom: 30px;"></p>
        <button class="big-btn" onclick="game.init()">å†æ¥ä¸€å±€ (Replay)</button>
    </div>

</div>

<script>
    // --- æ‰©å……åçš„é¢˜åº“ (32é¢˜ï¼Œä¿è¯20é¢˜ä¸é‡å¤) ---
    const sentenceLibrary = [
        { s: "The quick brown fox jumps over the dog.", w: [ {t:"adj",v:"quick"}, {t:"adj",v:"brown"}, {t:"n",v:"fox"}, {t:"v",v:"jumps"}, {t:"n",v:"dog"} ] },
        { s: "She carefully folded the paper.", w: [ {t:"adv",v:"carefully"}, {t:"v",v:"folded"}, {t:"n",v:"paper"} ] },
        { s: "Innovation drives economic growth.", w: [ {t:"n",v:"Innovation"}, {t:"v",v:"drives"}, {t:"adj",v:"economic"}, {t:"n",v:"growth"} ] },
        { s: "He spoke softly to the child.", w: [ {t:"v",v:"spoke"}, {t:"adv",v:"softly"}, {t:"n",v:"child"} ] },
        { s: "The heavy rain caused floods.", w: [ {t:"adj",v:"heavy"}, {t:"n",v:"rain"}, {t:"v",v:"caused"}, {t:"n",v:"floods"} ] },
        { s: "They happily accepted the offer.", w: [ {t:"adv",v:"happily"}, {t:"v",v:"accepted"}, {t:"n",v:"offer"} ] },
        { s: "Ideally we should monitor progress.", w: [ {t:"adv",v:"Ideally"}, {t:"v",v:"monitor"}, {t:"n",v:"progress"} ] },
        { s: "The sudden noise scared me.", w: [ {t:"adj",v:"sudden"}, {t:"n",v:"noise"}, {t:"v",v:"scared"} ] },
        { s: "Efficient systems save time.", w: [ {t:"adj",v:"Efficient"}, {t:"n",v:"systems"}, {t:"v",v:"save"}, {t:"n",v:"time"} ] },
        { s: "She runs very fast.", w: [ {t:"v",v:"runs"}, {t:"adv",v:"fast"} ] },
        { s: "The global economy is recovering.", w: [ {t:"adj",v:"global"}, {t:"n",v:"economy"}, {t:"v",v:"recovering"} ] },
        { s: "Scientists analyze the complex data.", w: [ {t:"n",v:"Scientists"}, {t:"v",v:"analyze"}, {t:"adj",v:"complex"}, {t:"n",v:"data"} ] },
        { s: "He eventually found the answer.", w: [ {t:"adv",v:"eventually"}, {t:"v",v:"found"}, {t:"n",v:"answer"} ] },
        { s: "The wooden table looks old.", w: [ {t:"adj",v:"wooden"}, {t:"n",v:"table"}, {t:"v",v:"looks"}, {t:"adj",v:"old"} ] },
        { s: "Please read the instructions carefully.", w: [ {t:"v",v:"read"}, {t:"n",v:"instructions"}, {t:"adv",v:"carefully"} ] },
        { s: "A happy life requires balance.", w: [ {t:"adj",v:"happy"}, {t:"n",v:"life"}, {t:"v",v:"requires"}, {t:"n",v:"balance"} ] },
        { s: "The cat sleeps peacefully.", w: [ {t:"n",v:"cat"}, {t:"v",v:"sleeps"}, {t:"adv",v:"peacefully"} ] },
        { s: "Dark clouds filled the sky.", w: [ {t:"adj",v:"Dark"}, {t:"n",v:"clouds"}, {t:"v",v:"filled"}, {t:"n",v:"sky"} ] },
        { s: "We successfully completed the project.", w: [ {t:"adv",v:"successfully"}, {t:"v",v:"completed"}, {t:"n",v:"project"} ] },
        { s: "Honesty is the best policy.", w: [ {t:"n",v:"Honesty"}, {t:"adj",v:"best"}, {t:"n",v:"policy"} ] },
        { s: "The bright sun warms the earth.", w: [ {t:"adj",v:"bright"}, {t:"n",v:"sun"}, {t:"v",v:"warms"}, {t:"n",v:"earth"} ] },
        { s: "They walked slowly through the park.", w: [ {t:"v",v:"walked"}, {t:"adv",v:"slowly"}, {t:"n",v:"park"} ] },
        { s: "Cultural diversity enriches society.", w: [ {t:"adj",v:"Cultural"}, {t:"n",v:"diversity"}, {t:"v",v:"enriches"}, {t:"n",v:"society"} ] },
        { s: "She creates beautiful art.", w: [ {t:"v",v:"creates"}, {t:"adj",v:"beautiful"}, {t:"n",v:"art"} ] },
        { s: "Suddenly the lights went out.", w: [ {t:"adv",v:"Suddenly"}, {t:"n",v:"lights"}, {t:"v",v:"went"} ] },
        { s: "Hard work brings success.", w: [ {t:"adj",v:"Hard"}, {t:"n",v:"work"}, {t:"v",v:"brings"}, {t:"n",v:"success"} ] },
        { s: "The train arrived late.", w: [ {t:"n",v:"train"}, {t:"v",v:"arrived"}, {t:"adv",v:"late"} ] },
        { s: "He is a famous writer.", w: [ {t:"v",v:"is"}, {t:"adj",v:"famous"}, {t:"n",v:"writer"} ] },
        { s: "Strict rules maintain order.", w: [ {t:"adj",v:"Strict"}, {t:"n",v:"rules"}, {t:"v",v:"maintain"}, {t:"n",v:"order"} ] },
        { s: "The bird flies high.", w: [ {t:"n",v:"bird"}, {t:"v",v:"flies"}, {t:"adv",v:"high"} ] },
        { s: "Local businesses need support.", w: [ {t:"adj",v:"Local"}, {t:"n",v:"businesses"}, {t:"v",v:"need"}, {t:"n",v:"support"} ] }
    ];

    // æ¸¸æˆæ§åˆ¶å™¨
    const game = {
        totalQuestions: 20,
        scorePerQ: 5,
        
        questionPool: [], // å­˜å‚¨æ‰“ä¹±åçš„é¢˜ç›®ç´¢å¼•
        currentQIndex: 0, // å½“å‰æ˜¯ç¬¬å‡ é¢˜ (1-20)
        currentScore: 0,
        
        currentData: null,
        targetWord: null,
        isProcessing: false,
        
        // åˆå§‹åŒ–
        init: function() {
            this.currentQIndex = 0;
            this.currentScore = 0;
            this.isProcessing = false;
            
            // ç”Ÿæˆæ‰“ä¹±çš„é¢˜ç›®ç´¢å¼• (Fisher-Yates Shuffle)
            this.questionPool = Array.from(Array(sentenceLibrary.length).keys());
            for (let i = this.questionPool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [this.questionPool[i], this.questionPool[j]] = [this.questionPool[j], this.questionPool[i]];
            }
            
            this.showScreen('startScreen');
        },

        // å¼€å§‹
        start: function() {
            this.showScreen('gameScreen');
            this.nextQuestion();
        },

        // ä¸‹ä¸€é¢˜
        nextQuestion: function() {
            if (this.currentQIndex >= this.totalQuestions) {
                this.endGame();
                return;
            }

            // ä»æ± å­ä¸­å–å‡ºä¸€ä¸ªä¸é‡å¤çš„ç´¢å¼•
            const dataIndex = this.questionPool[this.currentQIndex];
            this.currentQIndex++; // é¢˜ç›®è®¡æ•° +1
            
            this.updateStats();
            this.resetUI();

            this.currentData = sentenceLibrary[dataIndex];
            
            // éšæœºæŒ–ç©º (ä»è¯¥å¥å­çš„ words åˆ—è¡¨ä¸­é€‰ä¸€ä¸ª)
            const wIndex = Math.floor(Math.random() * this.currentData.w.length);
            this.targetWord = this.currentData.w[wIndex];

            this.render();
        },

        resetUI: function() {
            this.isProcessing = false;
            document.getElementById('optContainer').classList.remove('disabled');
            document.getElementById('feedbackMsg').innerText = "";
            document.querySelectorAll('.opt-btn').forEach(b => b.className = 'opt-btn');
            
            const hintBtn = document.getElementById('hintBtn');
            hintBtn.innerText = "ğŸ’¡ æ˜¾ç¤ºå¥å­ç»“æ„æç¤º";
            hintBtn.style.color = "var(--hint-text)";
            document.getElementById('sentenceDisplay').classList.remove('show-hints');
        },

        // æ¸²æŸ“å¥å­
        render: function() {
            const box = document.getElementById('sentenceDisplay');
            box.innerHTML = '';
            
            // åˆ†è¯æ­£åˆ™: å•è¯ OR æ ‡ç‚¹ OR ç©ºæ ¼
            const parts = this.currentData.s.match(/(\w+)|([^\w\s]+)|(\s+)/g);
            
            parts.forEach(part => {
                if (!part) return; // å®‰å…¨æ£€æŸ¥

                // 1. å¤„ç†ç©ºæ ¼ (ä¿æŒåŸæ ·ï¼Œä¸ç”¨åŒ…spanï¼Œä½†ä¸ºäº†inline-flexé—´è·ï¼Œè¿™é‡Œç¨å¾®ç‰¹æ®Šå¤„ç†)
                // åœ¨flex gapå¸ƒå±€ä¸‹ï¼Œç©ºæ ¼ä¼šè¢«æŠ˜å ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸»è¦é  gap æ¥æ§åˆ¶é—´è·ã€‚
                // ä½†å¦‚æœåŸæ–‡æœ‰ç©ºæ ¼ï¼Œæ­£åˆ™ä¼šåˆ‡å‡ºæ¥ã€‚æˆ‘ä»¬è¿™é‡Œå¦‚æœåˆ‡å‡ºæ¥çš„æ˜¯çº¯ç©ºæ ¼ï¼Œå¯ä»¥é€‰æ‹©å¿½ç•¥(å®Œå…¨é gap)ï¼Œ
                // æˆ–è€…æ¸²æŸ“ä¸º textNodeã€‚ä¸ºäº†æ’ç‰ˆç´§å‡‘ï¼Œæˆ‘ä»¬**å¿½ç•¥çº¯ç©ºæ ¼**ï¼Œæ”¹ç”¨ CSS çš„ gap æ§åˆ¶é—´è·ã€‚
                if (/^\s+$/.test(part)) {
                    return; 
                }
                
                // 2. å¤„ç†æ ‡ç‚¹ (è·Ÿéšå‰ä¸€ä¸ªè¯ï¼Œæˆ–è€…ä½œä¸ºç‹¬ç«‹å•å…ƒï¼Œä¸ºäº†ç®€å•ä½œä¸ºç‹¬ç«‹å•å…ƒä½†gapå¾ˆå°)
                // æˆ‘ä»¬é€šè¿‡æ­£åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯çº¯æ ‡ç‚¹
                if (/^[^\w]+$/.test(part)) {
                    const s = document.createElement('span');
                    s.innerText = part;
                    s.style.marginRight = "5px"; // æ ‡ç‚¹ååŠ ä¸€ç‚¹ç‚¹ç©ºéš™
                    box.appendChild(s);
                    return;
                }

                // 3. å¤„ç†å•è¯
                const unit = document.createElement('div');
                unit.className = 'word-unit';

                // åˆ¤æ–­æ˜¯å¦æ˜¯æŒ–ç©ºè¯
                if (part === this.targetWord.v) {
                    const blank = document.createElement('div');
                    blank.className = 'blank';
                    blank.id = 'targetBlank';
                    unit.appendChild(blank);
                } else {
                    const txt = document.createElement('span');
                    txt.className = 'word-text';
                    txt.innerText = part;
                    unit.appendChild(txt);
                    
                    // æŸ¥æ‰¾è¯¥è¯æ˜¯å¦æœ‰è¯æ€§æç¤º
                    const info = this.currentData.w.find(w => w.v === part);
                    const hint = document.createElement('span');
                    hint.className = 'pos-hint';
                    hint.innerText = info ? info.t + "." : ""; 
                    unit.appendChild(hint);
                }
                box.appendChild(unit);
            });
        },

        check: function(userType) {
            if (this.isProcessing) return;
            this.isProcessing = true;
            document.getElementById('optContainer').classList.add('disabled');

            const isCorrect = (userType === this.targetWord.t);
            const feedback = document.getElementById('feedbackMsg');
            
            const typeMap = {'n':0, 'v':1, 'adj':2, 'adv':3};
            const labelMap = {'n':'åè¯', 'v':'åŠ¨è¯', 'adj':'å½¢å®¹è¯', 'adv':'å‰¯è¯'};
            const btns = document.querySelectorAll('.opt-btn');
            
            // æ­æ™“å¡«ç©º
            const blank = document.getElementById('targetBlank');
            blank.className = 'revealed';
            blank.innerText = this.targetWord.v;
            blank.style.color = isCorrect ? 'var(--green)' : 'var(--red)';
            blank.style.borderBottomColor = isCorrect ? 'var(--green)' : 'var(--red)';

            if (isCorrect) {
                this.currentScore += this.scorePerQ;
                feedback.innerHTML = "<span style='color:var(--green)'>âœ… Correct!</span>";
                btns[typeMap[userType]].classList.add('correct');
                
                setTimeout(() => this.nextQuestion(), 1000);
            } else {
                feedback.innerHTML = `<span style='color:var(--red)'>âŒ é”™è¯¯ã€‚æ˜¯ ${labelMap[this.targetWord.t]} (${this.targetWord.v})</span>`;
                btns[typeMap[userType]].classList.add('wrong');
                setTimeout(() => btns[typeMap[this.targetWord.t]].classList.add('correct'), 200);
                
                setTimeout(() => this.nextQuestion(), 2200);
            }
            this.updateStats();
        },

        toggleHints: function() {
            const box = document.getElementById('sentenceDisplay');
            const btn = document.getElementById('hintBtn');
            
            if (box.classList.contains('show-hints')) {
                box.classList.remove('show-hints');
                btn.innerText = "ğŸ’¡ æ˜¾ç¤ºå¥å­ç»“æ„æç¤º";
                btn.style.color = "var(--hint-text)";
            } else {
                box.classList.add('show-hints');
                btn.innerText = "ğŸ™ˆ éšè—ç»“æ„æç¤º";
                btn.style.color = "var(--accent)";
            }
        },

        updateStats: function() {
            document.getElementById('qCount').innerText = this.currentQIndex;
            document.getElementById('currentScore').innerText = this.currentScore;
        },

        endGame: function() {
            document.getElementById('finalScoreDisplay').innerText = this.currentScore;
            
            let comment = "";
            if (this.currentScore === 100) comment = "å®Œç¾å…¨å¯¹ï¼è¯­æ³•å¤§å¸ˆï¼ğŸ†";
            else if (this.currentScore >= 80) comment = "ä¼˜ç§€ï¼åŸºç¡€éå¸¸æ‰å®ã€‚âœ¨";
            else if (this.currentScore >= 60) comment = "åŠæ ¼äº†ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ“š";
            else comment = "å†è¯•ä¸€æ¬¡ï¼Œç†Ÿèƒ½ç”Ÿå·§ï¼ğŸ’ª";
            
            document.getElementById('resultComment').innerText = comment;
            this.showScreen('endScreen');
        },

        showScreen: function(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    };

    game.init();

</script>

</body>
</html>